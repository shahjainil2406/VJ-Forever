    <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VJ ki Shahi Dastaan</title>
    <meta name="description" content="A beautiful timeline of our love story with countdown timer and romantic memories">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ’Œ</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ’Œ</text></svg>">
    
    <!-- Mobile-first responsive design -->
    <meta name="theme-color" content="#e8f0e4">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <!-- Preload critical fonts for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Dancing+Script:wght@400;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- CSS files -->
    <link rel="stylesheet" href="css/styles.css?v=6">
    <link rel="stylesheet" href="css/timeline.css?v=6">
    <link rel="stylesheet" href="css/responsive.css?v=6">
    
    <!-- Inline critical CSS for immediate visibility -->
    <style>
        /* Critical CSS for immediate display */
        .countdown-header {
            background: linear-gradient(135deg, #e8f0e4, #f0f8f0);
            padding: 1.5rem 1rem;
            min-height: 200px;
            display: block !important;
            visibility: visible !important;
        }
        
        .countdown-timer {
            text-align: center;
            display: block !important;
            visibility: visible !important;
        }
        
        .timer-display {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            flex-wrap: wrap;
            min-height: 80px;
        }
        
        .timer-unit {
            background: #f4f9f4;
            border: 2px solid #e8f0e4;
            border-radius: 15px;
            padding: 0.75rem 0.5rem;
            min-width: 70px;
            text-align: center;
            display: inline-block;
            margin: 0.25rem;
        }
        
        .timer-number {
            display: block;
            font-size: 1.5rem;
            font-weight: bold;
            color: #6b8e5a;
        }
        
        .timer-label {
            display: block;
            font-size: 0.8rem;
            color: #5a5a5a;
        }
        
        .timeline-section {
            background: linear-gradient(180deg, #f0f8f0, #e8f0e4);
            padding: 2rem 1rem;
            min-height: 60vh;
            display: block !important;
            visibility: visible !important;
        }
        
        .timeline-events {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            min-height: 200px;
        }
        
        .timeline-wrapper {
            background: none !important;
            border: none !important;
            box-shadow: none !important;
            border-radius: 0 !important;
            margin: 0.5rem auto !important;
            padding: 1rem !important;
        }
        
        .event-card {
            background: linear-gradient(135deg, #faf7f8, #f4f9f4);
            border: 2px solid #e8f0e4;
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            min-height: 80px;
            display: block;
            max-width: 300px;
        }
        
        .event-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(232, 240, 228, 0.4);
        }
        
        .love-story-message {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            gap: 1rem;
            flex-wrap: wrap;
            visibility: visible !important;
        }
        
        .love-story-text {
            font-family: 'Great Vibes', cursive !important;
            font-size: 2.5rem !important;
            color: #2d5a2d !important;
            margin: 0 !important;
            text-shadow: 2px 2px 4px rgba(232, 240, 228, 0.6);
            background: linear-gradient(45deg, #2d5a2d, #6b8e5a, #4a7c59);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gentlePulse 3s ease-in-out infinite;
            display: block !important;
            visibility: visible !important;
        }
        
        .love-story-footer .panda-icon {
            font-size: 2rem;
            animation: gentlePulse 2s ease-in-out infinite;
        }
        
        @keyframes gentlePulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.05); opacity: 1; }
        }
        
        /* Mobile responsive for footer */
        @media (max-width: 768px) {
            .love-story-text {
                font-size: 2rem;
            }
            
            .love-story-footer {
                padding: 2rem 1rem;
            }
            
            .love-story-message {
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Main Timeline Landing Page -->
    <!-- Authentication Overlay -->
    <div class="auth-overlay" id="auth-overlay">
        <div class="auth-container">
            <div class="auth-header">
                <div class="auth-pandas">ğŸ¼â¤ï¸ğŸ¼</div>
                <h1 class="auth-title">Welcome to Our Love Story</h1>
                <p class="auth-subtitle">Prove that you are Vidhi ğŸ˜…</p>
            </div>
            
            <form class="auth-form" id="auth-form">
                <div class="auth-input-group">
                    <input 
                        type="password" 
                        id="password-input" 
                        class="auth-input" 
                        placeholder="What do I call you with love ? ğŸ’­" 
                        required 
                        autocomplete="off"
                        spellcheck="false"
                    >
                    <button type="submit" class="auth-submit">
                        <span class="submit-text">Am I allowed ?</span>
                    </button>
                </div>
                
                <div class="auth-error" id="auth-error">
                    <p>No you are not Vidhi, that's not right to check our Love story... Try again! ğŸ’­</p>
                </div>
                
                <div class="auth-loading" id="auth-loading">
                    <div class="loading-pandas">ğŸ¼ğŸ’•ğŸ¼</div>
                    <p>Good you are my Boobli... ğŸ’•</p>
                </div>
            </form>
            
            <div class="auth-decorations">
                <div class="floating-heart heart-1">ğŸ’•</div>
                <div class="floating-heart heart-2">ğŸ’–</div>
                <div class="floating-heart heart-3">ğŸ’—</div>
                <div class="floating-heart heart-4">ğŸ’š</div>
            </div>
        </div>
    </div>

    <main class="timeline-page" id="timeline-content">
        <!-- Countdown Timer Header -->
        <header class="countdown-header">
            <div class="countdown-timer" id="countdown-timer">
                <div class="timer-title">
                    <h1>â¤ï¸ Days Together â¤ï¸</h1>
                </div>
                <div class="timer-display" id="timer-display">
                    <!-- Initial timer display while JavaScript loads -->
                    <div class="timer-unit">
                        <span class="timer-number">--</span>
                        <span class="timer-label">Days</span>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number">--</span>
                        <span class="timer-label">Hours</span>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number">--</span>
                        <span class="timer-label">Minutes</span>
                    </div>
                    <div class="timer-unit">
                        <span class="timer-number">--</span>
                        <span class="timer-label">Seconds</span>
                    </div>
                </div>
                <div class="timer-message">
                    <p>Since we said yes for Dal-Chawal â¤ï¸</p>
                </div>
            </div>
        </header>

        <!-- Interactive Timeline Section -->
        <section class="timeline-section">
            <div class="timeline-container">
                <h2 class="timeline-title">Our Love Story</h2>
                
                <!-- Vertical Timeline -->
                <div class="timeline-wrapper">
                    <div class="timeline-bar" id="timeline-bar">
                        <!-- Vertical timeline events container -->
                        <div class="timeline-events" id="timeline-events">
                            <!-- Timeline events will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Floating Panda and Heart Decorations -->
        <div class="floating-decorations">
            <div class="panda-decoration panda-1">ğŸ¼</div>
            <div class="panda-decoration panda-2">ğŸ¼</div>
            <div class="panda-decoration panda-3">ğŸ¼</div>
            <div class="panda-decoration panda-4">ğŸ¼</div>
            <div class="panda-decoration panda-5">ğŸ¼</div>
            <div class="panda-decoration panda-6">ğŸ¼</div>
            <div class="heart-decoration heart-1">ğŸ’•</div>
            <div class="heart-decoration heart-2">ğŸ’–</div>
            <div class="heart-decoration heart-3">ğŸ’—</div>
            <div class="heart-decoration heart-4">ğŸ’•</div>
            <div class="heart-decoration heart-5">ğŸ’–</div>
            <div class="heart-decoration heart-6">ğŸ’—</div>
        </div>
    </main>

    <!-- JavaScript files -->
    <script src="data/timeline-data.js"></script>
    <script src="js/utils.js"></script>

    <script>
        // Authentication Configuration
        const AUTH_CONFIG = {
            SECRET_WORD: 'boobli',           // The secret password
            LOADING_DELAY: 1000,             // Delay before content reveal (ms)
            ERROR_DISPLAY_TIME: 2000,        // How long to show errors (ms)
            HINT_TEXT: 'What do I call you ?', // Password hint
            SESSION_KEY: 'love_story_authenticated', // localStorage key for session
            NAVIGATION_KEY: 'love_story_navigation', // sessionStorage key for navigation tracking
            SESSION_DURATION: 60 * 60 * 1000 // 30 minutes in milliseconds (shorter for security)
        };

        // Global variables for navigation control
        let backNavigationHandler = null;
        let pageUnloadHandler = null;

        // Authentication System
        function initializeAuthentication() {
            const authOverlay = document.getElementById('auth-overlay');
            const authForm = document.getElementById('auth-form');
            const passwordInput = document.getElementById('password-input');
            const authError = document.getElementById('auth-error');
            const authLoading = document.getElementById('auth-loading');
            const timelineContent = document.getElementById('timeline-content');

            // Check if user is already authenticated
            if (isAlreadyAuthenticated()) {
                console.log('ğŸ”“ User already authenticated via navigation, skipping auth overlay');
                // Hide auth overlay immediately
                if (authOverlay) {
                    authOverlay.style.display = 'none';
                }
                showTimelineContent();
                return;
            } else {
                console.log('ğŸ”’ User not authenticated or page refreshed, showing auth overlay');
                // Prevent back navigation during authentication
                preventBackNavigation();
            }

            // Auto-focus password input when page loads (only if auth overlay is shown)
            if (passwordInput) {
                passwordInput.focus();
            }

            // Handle form submission
            if (authForm) {
                authForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const userInput = passwordInput.value;
                    
                    // Validate password
                    if (validatePassword(userInput)) {
                        // Success path
                        showLoadingMessage();
                        
                        // Store authentication in session
                        storeAuthenticationSession();
                        
                        setTimeout(() => {
                            showTimelineContent();
                            // Re-enable back navigation after successful authentication
                            enableBackNavigation();
                        }, AUTH_CONFIG.LOADING_DELAY);
                    } else {
                        // Error path
                        showErrorMessage();
                        addVisualFeedback();
                        clearInputField();
                        
                        // Auto-hide error after timeout
                        setTimeout(() => {
                            hideErrorMessage();
                        }, AUTH_CONFIG.ERROR_DISPLAY_TIME);
                    }
                });
            }

            // Prevent back navigation during authentication
            function preventBackNavigation() {
                // Add a dummy history entry
                history.pushState(null, null, window.location.href);
                
                // Create handler functions
                backNavigationHandler = function(event) {
                    // Push the current state back to prevent navigation
                    history.pushState(null, null, window.location.href);
                    
                    // Show a message to the user
                    showBackButtonWarning();
                    
                    console.log('ğŸš« Back navigation attempt blocked');
                };

                pageUnloadHandler = function(event) {
                    // This will show a browser confirmation dialog
                    const message = 'Are you sure you want to leave? You will need to enter the secret word again.';
                    event.returnValue = message;
                    return message;
                };
                
                // Listen for popstate events (back button)
                window.addEventListener('popstate', backNavigationHandler);
                
                // Also prevent page unload during authentication (optional)
                window.addEventListener('beforeunload', pageUnloadHandler);
                
                console.log('ğŸš« Back navigation disabled during authentication');
            }

            // Show warning when user tries to go back during authentication
            function showBackButtonWarning() {
                // Create a temporary warning message using CSS classes
                const warning = document.createElement('div');
                warning.className = 'back-nav-warning';
                warning.innerHTML = 'ğŸ”’ Please enter the secret word to continue ğŸ’­';
                
                document.body.appendChild(warning);
                
                // Fade in using CSS class
                setTimeout(() => warning.classList.add('show'), 100);
                
                // Fade out and remove after 3 seconds
                setTimeout(() => {
                    warning.classList.remove('show');
                    setTimeout(() => {
                        if (warning.parentNode) {
                            warning.parentNode.removeChild(warning);
                        }
                    }, 300);
                }, 3000);
            }

            // Re-enable back navigation after successful authentication
            function enableBackNavigation() {
                if (backNavigationHandler) {
                    window.removeEventListener('popstate', backNavigationHandler);
                    backNavigationHandler = null;
                }
                if (pageUnloadHandler) {
                    window.removeEventListener('beforeunload', pageUnloadHandler);
                    pageUnloadHandler = null;
                }
                console.log('âœ… Back navigation re-enabled after authentication');
            }

            // Check if user is already authenticated
            function isAlreadyAuthenticated() {
                try {
                    // Check if this is a page refresh vs navigation
                    const isNavigation = sessionStorage.getItem(AUTH_CONFIG.NAVIGATION_KEY);
                    
                    // If no navigation flag, this is likely a refresh or direct access
                    if (!isNavigation) {
                        console.log('ğŸ”„ Page refresh or direct access detected, requiring authentication');
                        // Clear any existing auth session on refresh
                        localStorage.removeItem(AUTH_CONFIG.SESSION_KEY);
                        return false;
                    }
                    
                    // Clear the navigation flag after checking
                    sessionStorage.removeItem(AUTH_CONFIG.NAVIGATION_KEY);
                    
                    // Check localStorage for authentication
                    const authData = localStorage.getItem(AUTH_CONFIG.SESSION_KEY);
                    if (!authData) {
                        return false;
                    }

                    const { timestamp, authenticated } = JSON.parse(authData);
                    const now = Date.now();
                    
                    // Check if session is still valid (within 30 minutes)
                    if (authenticated && (now - timestamp) < AUTH_CONFIG.SESSION_DURATION) {
                        console.log('ğŸ”“ Valid navigation session found');
                        return true;
                    } else {
                        // Session expired, clear it
                        console.log('â° Session expired, clearing authentication');
                        localStorage.removeItem(AUTH_CONFIG.SESSION_KEY);
                        return false;
                    }
                } catch (error) {
                    console.error('Error checking authentication session:', error);
                    // Clear corrupted session data
                    localStorage.removeItem(AUTH_CONFIG.SESSION_KEY);
                    sessionStorage.removeItem(AUTH_CONFIG.NAVIGATION_KEY);
                    return false;
                }
            }

            // Store authentication session
            function storeAuthenticationSession() {
                try {
                    const authData = {
                        authenticated: true,
                        timestamp: Date.now()
                    };
                    localStorage.setItem(AUTH_CONFIG.SESSION_KEY, JSON.stringify(authData));
                    console.log('ğŸ” Authentication session stored');
                } catch (error) {
                    console.error('Error storing authentication session:', error);
                }
            }

            // Password validation logic
            function validatePassword(userInput) {
                // Normalize input: lowercase and trim whitespace
                const normalizedInput = userInput.toLowerCase().trim();
                
                // Compare with secret word
                return normalizedInput === AUTH_CONFIG.SECRET_WORD;
            }

            // Show loading message
            function showLoadingMessage() {
                if (authLoading) {
                    authLoading.classList.add('show');
                }
                
                // Hide error if visible
                hideErrorMessage();
            }

            // Show error message
            function showErrorMessage() {
                if (authError) {
                    authError.classList.add('show');
                }
                
                // Hide loading if visible
                if (authLoading) {
                    authLoading.classList.remove('show');
                }
            }

            // Hide error message
            function hideErrorMessage() {
                if (authError) {
                    authError.classList.remove('show');
                }
            }

            // Add visual feedback (shake animation)
            function addVisualFeedback() {
                if (passwordInput) {
                    passwordInput.classList.add('error');
                    
                    // Remove error class after animation
                    setTimeout(() => {
                        passwordInput.classList.remove('error');
                    }, 500);
                }
            }

            // Clear input field
            function clearInputField() {
                if (passwordInput) {
                    passwordInput.value = '';
                    passwordInput.focus();
                }
            }

            // Show timeline content and hide auth overlay
            function showTimelineContent() {
                if (authOverlay && timelineContent) {
                    // Hide auth overlay
                    authOverlay.classList.add('hidden');
                    
                    // Show timeline content
                    timelineContent.classList.add('authenticated');
                    timelineContent.style.display = 'block';
                    
                    // Initialize timeline after authentication
                    setTimeout(() => {
                        initializeTimeline();
                    }, 500);
                }
            }
        }

        // Function to clear authentication (for testing or logout)
        function clearAuthentication() {
            localStorage.removeItem(AUTH_CONFIG.SESSION_KEY);
            sessionStorage.removeItem(AUTH_CONFIG.NAVIGATION_KEY);
            console.log('ğŸ”“ Authentication session and navigation flag cleared');
            
            // Remove any navigation prevention listeners before reload
            if (backNavigationHandler) {
                window.removeEventListener('popstate', backNavigationHandler);
                backNavigationHandler = null;
            }
            if (pageUnloadHandler) {
                window.removeEventListener('beforeunload', pageUnloadHandler);
                pageUnloadHandler = null;
            }
            
            // Reload page to show auth overlay again
            window.location.reload();
        }

        // Make clearAuthentication available globally for debugging
        window.clearAuthentication = clearAuthentication;

        // Enhanced initialization using consolidated utilities
        console.log('ğŸ¼ Love Story Webapp initializing...');
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¼ DOM loaded, initializing authentication and timeline...');
            
            // Initialize authentication system first
            initializeAuthentication();
            
            // Timeline initialization function (called after successful auth)
            function initializeTimeline() {
                // Run consolidated integration validation
                const integrationResults = ValidationManager.validateIntegration();
                
                try {
                    // Initialize countdown timer using consolidated utility
                    const timerDisplay = document.getElementById('timer-display');
                    if (timerDisplay) {
                        console.log('âœ… Timer display found');
                        
                        // Set the day we said yes (July 26th, 2025, 5:30 PM IST - Dal Chawal day)
                        const dalChawalDate = '2025-07-26T17:30:00+05:30';
                        const timer = new CountdownTimer(dalChawalDate, timerDisplay);
                        timer.start();
                        console.log('âœ… Consolidated timer started');
                    } else {
                        console.error('âŒ Timer display element not found');
                    }
                    
                    // Enhanced timeline with consolidated event handlers
                    const timelineBar = document.getElementById('timeline-bar');
                    const timelineEvents = document.getElementById('timeline-events');
                    
                    if (timelineBar && timelineEvents) {
                        console.log('âœ… Vertical timeline elements found');
                        
                        // Use timeline data from external file
                        const events = TIMELINE_DATA.events.map(event => ({
                            id: event.id,
                            title: event.title,
                            nickname: event.nickname,
                            date: event.date,
                            icon: event.icon,
                            preview: event.previewText,
                            location: event.location || null
                        }));
                        
                        console.log('ğŸ“ Creating vertical timeline with', events.length, 'events');
                        
                        // Clear existing content
                        timelineEvents.innerHTML = '';
                        
                        // Create vertical timeline events
                        events.forEach((event, index) => {
                            console.log(`ğŸ¼ Creating vertical event ${index} (${event.nickname})`);
                            
                            // Create timeline event container
                            const eventContainer = document.createElement('div');
                            eventContainer.className = 'timeline-event';
                            eventContainer.setAttribute('data-index', index);
                            eventContainer.setAttribute('data-event-id', event.id);
                            
                            // Create event content
                            const eventContent = document.createElement('div');
                            eventContent.className = 'event-content';
                            
                            // Format date as dd/mm/yy
                            const eventDate = new Date(event.date);
                            const day = eventDate.getDate().toString().padStart(2, '0');
                            const month = (eventDate.getMonth() + 1).toString().padStart(2, '0');
                            const year = eventDate.getFullYear().toString().slice(-2);
                            const dateText = `${day}/${month}/${year}`;
                            
                            eventContent.innerHTML = `
                                <div class="event-date">${dateText}</div>
                                <div class="event-title">${event.nickname || event.title}</div>
                                <div class="event-preview">${event.preview}</div>
                            `;
                            
                            // Add consolidated navigation handler
                            const detailPageUrl = `event-detail.html?event=${event.id}`;
                            EventHandlerManager.addNavigationHandler(eventContent, detailPageUrl);
                            
                            // Assemble the event
                            eventContainer.appendChild(eventContent);
                            timelineEvents.appendChild(eventContainer);
                            
                            console.log('âœ… Added vertical timeline event:', event.nickname || event.title);
                        });
                        
                        // Add staggered fade-in animation using consolidated utility
                        const eventElements = timelineEvents.querySelectorAll('.timeline-event');
                        AnimationManager.addStaggeredFadeIn(Array.from(eventElements), 150);
                        
                        console.log('âœ… Vertical timeline created successfully');
                    } else {
                        console.error('âŒ Vertical timeline elements not found');
                    }
                    
                    console.log('ğŸ‰ Consolidated integration complete!');
                    
                } catch (error) {
                    console.error('âŒ Error in consolidated integration initialization:', error);
                }
            }
            
            // Make initializeTimeline available globally for auth system
            window.initializeTimeline = initializeTimeline;
        });
        
        // Initialize romantic enhancements after everything loads
        setTimeout(() => {
            console.log('ğŸ¼ğŸ’• Initializing romantic enhancements...');
            document.body.classList.add('integration-complete');
            console.log('ğŸ‰ Authentication and Timeline Integration Complete!');
        }, 2000);
    </script>
    <script src="js/mobile-performance.js"></script>
    <script src="js/animations.js"></script>